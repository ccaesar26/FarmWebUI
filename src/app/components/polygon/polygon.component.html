<div class="flex flex-col items-end gap-2 min-w-full min-h-64">

  <div class="flex justify-center gap-2">
    <!-- Custom Draw Polygon Button -->
    <p-button
      type="button"
      icon="pi pi-pencil"
      pTooltip="Click on the map to place the corners of your filed."
      (click)="startDrawingPolygon()">
    </p-button>

    <!-- Custom Trash Button -->
    <p-button
      type="button"
      icon="pi pi-trash"
      pTooltip="Select a field and click on this button to delete it."
      (click)="trashDrawing()">
    </p-button>
  </div>

  <div id="map" class="w-full h-80 rounded-lg"></div>

  <div class="flex justify-center">
    <p-button type="button" (click)="showDialog()" icon="pi pi-external-link" label="Edit selection"></p-button>
  </div>

  <p-dialog
    header="Selected fields"
    [resizable]="false"
    [modal]="true"
    [maximizable]="true"
    appendTo="body"
    [(visible)]="dialogVisible"
    [style]="{ width: '75vw', height: '75vh' }"
    [contentStyle]="{ display: 'flex', flexDirection: 'column', height: '100%' }"
  >
    <div class="flex flex-col h-full">
      <p-table
        [value]="polygons"
        [scrollable]="true"
        scrollHeight="flex"
        editMode="row"
        dataKey="id"
        class="flex-1 overflow-auto fixed-table"
      >
        <!-- Table Header -->
        <ng-template pTemplate="header">
          <tr class="bg-gray-100 sticky top-0">
            <th class="p-3 text-left w-5/12">Name</th>
            <th class="p-3 text-left w-5/12">Coordinates</th>
            <th class="p-3 text-center w-2/12">Actions</th>
          </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template pTemplate="body" let-polygon let-editing="editing" let-ri="rowIndex">
          <tr [pEditableRow]="polygon">
            <!-- Editable Name Column -->
            <td class="p-3">
              <p-cellEditor>
                <ng-template #input>
                  <input
                    pInputText
                    type="text"
                    [(ngModel)]="polygon.name"
                    class="w-full"
                  />
                </ng-template>
                <ng-template #output>
                  {{ polygon.name }}
                </ng-template>
              </p-cellEditor>
            </td>

            <!-- Non-editable Coordinates Column -->
            <td class="p-3">
              <ul>
                <li *ngFor="let coord of polygon.coordinates" class="text-gray-600">
                  {{ coord[0] }}, {{ coord[1] }}
                </li>
              </ul>
            </td>

            <!-- Action Buttons -->
            <td class="p-3 w-32">
              <div class="flex items-center justify-center gap-2">
                <button
                  *ngIf="!editing"
                  pButton
                  pRipple
                  type="button"
                  pInitEditableRow
                  icon="pi pi-pencil"
                  (click)="onRowEditInit(polygon)"
                  text
                  rounded
                  severity="secondary"
                ></button>
                <button
                  *ngIf="editing"
                  pButton
                  pRipple
                  type="button"
                  pSaveEditableRow
                  icon="pi pi-check"
                  (click)="onRowEditSave()"
                  text
                  rounded
                  severity="secondary"
                ></button>
                <button
                  *ngIf="editing"
                  pButton
                  pRipple
                  type="button"
                  pCancelEditableRow
                  icon="pi pi-times"
                  (click)="onRowEditCancel(polygon)"
                  text
                  rounded
                  severity="secondary"
                ></button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <ng-template #footer>
      <p-button label="Close" (onClick)="dialogVisible = false"/>
    </ng-template>
  </p-dialog>
</div>
